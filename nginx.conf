server {
    listen 80;
    # IMPORTANT: Replace placeholders with your actual domain name(s) and/or VPS IP address
    server_name your_domain.com www.your_domain.com your_vps_ip localhost;

    # Use Docker's internal DNS resolver (standard practice)
    resolver 127.0.0.11;

    # Serve static frontend files (copied into /usr/share/nginx/html by Dockerfile.frontend)
    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
        try_files $uri $uri/ /index.html; # Handles Single Page Application routing
    }

    # Serve Django's collected static files (e.g., admin, DRF static)
    # The 'alias' should point to the STATIC_ROOT directory INSIDE the backend container
    location /static/ {
        # This path assumes your backend Dockerfile collected static files into '/app/staticfiles/'
        alias /app/staticfiles/;
        expires 1y;             # Cache static files aggressively
        access_log off;         # Optional: Reduces logging noise
        add_header Cache-Control "public";
    }

    # Proxy API requests to the backend Django/Gunicorn service
    location /api/ {
        # IMPORTANT: Replace 'backend' with the actual service name defined in your
        # docker-compose.yml or the container name/IP if running manually.
        # The port '2267' should match the port Gunicorn binds to in your backend Dockerfile.
        # set $backend "http://backend:2267"; # Adjust 'backend' if needed!
        set $backend "http://ms0gcw884wcoc48ccg4c4cg0:2267";

        proxy_pass $backend;

        # Standard proxy headers to forward client information to Django
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_redirect off; # Prevents backend redirects from rewriting the host/port
    }

    # Basic error page handling
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html; # Serve error page from the frontend's root
    }
}

